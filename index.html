<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>QU·∫¢N L√ù TH√îNG TIN & ƒêI·ªÇM CHO SV (FOXSTUDIO)</title>
     <link rel="icon" type="image/png" href="https://uploads.onecompiler.io/43u4wb3ft/43unfu266/Black%20and%20White%20Circle%20Class%20Logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #0f172a;
            --text-color: #e2e8f0;
            --card-bg: #1e293b;
            --border-color: #334155;
            --input-bg: #334155;
            --input-border: #475569;
            --accent-color: #0ea5e9;
            --sidebar-bg: #1e293b;
            --main-font-color: var(--text-color);
        }

        body.light-mode {
            --bg-color: #f1f5f9;
            --text-color: #0f172a;
            --card-bg: rgba(255, 255, 255, 0.45);
            --sidebar-bg: rgba(255, 255, 255, 0.35);
            --border-color: rgba(203, 213, 225, 0.5);
            --input-bg: #e2e8f0;
            --input-border: #cbd5e1;
            --accent-color: #2563eb;
            --main-font-color: var(--text-color);
        }
        body.light-mode .sidebar,
        body.light-mode .modal-content,
        body.light-mode .student-card,
        body.light-mode .bg-card-bg {
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--main-font-color);
            transition: background-color 0.3s, color 0.3s;
            display: flex;
        }

        .custom-bg {
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .input-style {
            width: 100%; padding: 0.625rem 1rem;
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 0.5rem; color: var(--main-font-color);
            outline: none; transition: border-color .15s, box-shadow .15s;
        }
        .input-style:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 40%, transparent);
        }
        .input-style-sm {
            width: 100%; padding: 0.5rem 0.75rem;
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 0.375rem; color: var(--main-font-color);
            outline: none; font-size: 0.875rem; transition: border-color .15s, box-shadow .15s;
        }
        .input-style-sm:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 1px color-mix(in srgb, var(--accent-color) 40%, transparent);
        }
        .btn-primary {
            display: flex; align-items: center; justify-content: center;
            background-image: linear-gradient(to right, var(--accent-color), color-mix(in srgb, var(--accent-color) 70%, #06b6d4));
            color: white; font-weight: 600; padding: 0.75rem 1rem; border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all .3s;
        }
        .btn-primary[disabled], .btn-primary.disabled { opacity: .5; cursor: not-allowed; }
        .btn-secondary {
            display: flex; align-items: center; justify-content: center;
            background-color: var(--secondary-color); color: var(--text-color);
            font-weight: 600; padding: 0.75rem 1rem; border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .btn-outline-sky {
            display: flex; align-items: center; justify-content: center;
            color: var(--accent-color); padding: 0.75rem; border: 1px solid var(--accent-color);
            border-radius: 0.375rem; transition: all .15s;
        }
        .btn-outline-sky:hover { background: rgba(56,189,248,.1); }
        .btn-outline-red {
            display: inline-flex; align-items: center; justify-content: center;
            color: rgb(239 68 68 / 1); border: 1px solid rgb(239 68 68 / 1);
            border-radius: 0.375rem; padding: 0.5rem 1rem; transition: all .15s; font-weight: 500;
        }
        .btn-outline-red:hover { background-color: rgba(239, 68, 68, 0.1); color: rgb(248 113 113 / 1); }
        .btn-outline-blue {
            display: inline-flex; align-items: center; justify-content: center;
            color: rgb(59 130 246 / 1); border: 1px solid rgb(59 130 246 / 1);
            border-radius: 0.375rem; padding: 0.5rem 1rem; transition: all .15s; font-weight: 500;
        }
        .btn-outline-blue:hover { background-color: rgba(59, 130, 246, 0.1); color: rgb(96 165 250 / 1); }
        .btn-icon-danger { color: rgb(239 68 68 / 1); padding: 0.375rem; border-radius: 0.375rem; transition: all .15s; }
        .btn-icon-danger:hover { color: rgb(248 113 113 / 1); background: rgba(239,68,68,.1); }
        .btn-icon-edit { color: rgb(251 191 36); padding: 0.375rem; border-radius: 0.375rem; transition: all .15s; }
        .btn-icon-edit:hover { color: rgb(253 224 71); background: rgba(251,191,36,.1); }

        .text-accent { color: var(--accent-color); }
        .bg-card-bg { background-color: var(--card-bg); }
        .border-main { border-color: var(--border-color); }
        .text-main-font { color: var(--main-font-color); }

        .th-style { padding: 0.75rem 1rem; color: var(--main-font-color); opacity: 0.8; font-weight: 600; }
        .td-style { padding: 0.875rem 1rem; color: var(--main-font-color); }
        .course-table-wrap { overflow-x: auto; }
        .course-table-wrap table { min-width: 600px; }

        .sidebar {
            background-color: var(--sidebar-bg);
            transition: transform 0.3s ease-in-out;
            box-shadow: 2px 0 5px rgba(0,0,0,0.5);
            z-index: 50;
            display: flex; flex-direction: column;
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s, color 0.2s;
            white-space: nowrap;
        }
        .sidebar-link.active {
            background-color: var(--accent-color);
            color: white;
            font-weight: bold;
        }
        .sidebar-link:hover {
            background-color: color-mix(in srgb, var(--accent-color) 15%, transparent);
            color: var(--accent-color);
        }
        .sidebar-link.active:hover {
            background-color: var(--accent-color);
            color: white;
        }
        .sidebar-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); z-index: 40; display: none;
        }
        .sidebar-backdrop.active { display: block; }

        .fixed-buttons {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .fixed-buttons button:hover {
            transform: scale(1.1);
        }

        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none; justify-content: center; align-items: center;
            z-index: 100;
        }
        .modal-content {
            background-color: var(--card-bg); padding: 2rem; border-radius: 0.75rem;
            max-height: 90%; overflow-y: auto; max-width: 600px; width: 90%;
            box-shadow: 0 10px 15px rgba(0,0,0,0.2);
            position: relative;
            color: var(--main-font-color);
        }
        .modal.show { display: flex; }
        .modal-close-btn {
            position: absolute; top: 1rem; right: 1rem; color: var(--text-color);
            transition: color 0.2s;
        }
        .modal-close-btn:hover { color: var(--accent-color); }

        .chatbot-container {
            position: fixed; bottom: 6rem; right: 1rem; z-index: 100; width: 100%; max-width: 380px; height: 500px;
            display: none; flex-direction: column; background-color: var(--card-bg);
            border-radius: 0.75rem; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transform-origin: bottom right; transform: scale(0.9); opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .chatbot-container.active { display: flex; transform: scale(1); opacity: 1; }
        .chatbot-header {
            background-image: linear-gradient(to right, var(--accent-color), color-mix(in srgb, var(--accent-color) 70%, #06b6d4));
            color: white; padding: 1rem; border-radius: 0.75rem 0.75rem 0 0;
            display: flex; justify-content: space-between; align-items: center; font-weight: 600; cursor: pointer;
        }
        .chatbot-messages { flex-grow: 1; padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 0.75rem; }
        .message { max-width: 85%; padding: 0.6rem 0.9rem; border-radius: 1rem; word-wrap: break-word; line-height: 1.4; }
        .user-message { background-color: #3b82f6; color: white; align-self: flex-end; border-bottom-right-radius: 0.25rem; }
        .bot-message { background-color: var(--secondary-color); color: var(--text-color); align-self: flex-start; border-bottom-left-radius: 0.25rem; }

        @media print {
            body { background-color: white !important; color: black !important; padding: 0 !important; margin: 0 !important; }
            header, main, .sidebar, .fixed-buttons, footer, .modal { display: none !important; }
            #printContent { display: block !important; position: static !important; width: 100% !important; }
            .print-page { page-break-after: always; box-shadow: none !important; border: none !important; background-color: white !important; color: black !important; padding: 20px !important; }
            .print-page:last-child { page-break-after: avoid; }
            .print-title { text-align: center; font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #333 !important; border-bottom: 2px solid #ccc; padding-bottom: 10px; }
            .print-info { margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
            .print-info p { line-height: 1.5; font-size: 14px; color: #555 !important; }
            .print-info strong { color: black !important; }
            .course-table-wrap table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            .course-table-wrap th, .course-table-wrap td { color: black !important; border: 1px solid #ddd !important; padding: 8px !important; text-align: center !important; font-size: 12px; }
            .course-table-wrap th { background-color: #f2f2f2 !important; font-weight: bold; }
            .gpa-info { display: block !important; margin-top: 20px; padding: 10px; border: 1px solid #ccc; background-color: #f8f8f8; }
            .gpa-info span { color: black !important; }
            .gpa-info .text-emerald-400 { color: #22c55e !important; }
        }
    </style>
</head>

<body class="flex">
    
    <aside id="sidebar" class="sidebar fixed top-0 left-0 h-full w-64 bg-card-bg shadow-lg transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-50">
        <div>
            <div class="p-4 flex items-center justify-between border-b border-main">
                <h2 class="text-2xl font-bold text-accent">Menu</h2>
                <button id="close-sidebar-btn" class="md:hidden text-2xl text-main-font leading-none">&times;</button>
            </div>
            <nav class="p-4 space-y-2">
                <a href="#" class="sidebar-link active" data-tab="intro">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    Gi·ªõi Thi·ªáu
                </a>
                <a href="#" class="sidebar-link" data-tab="add-student">
                     <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>
                    Th√™m Sinh Vi√™n
                </a>
                <a href="#" class="sidebar-link" data-tab="student-list">
                     <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    Danh S√°ch SV
                </a>
                <a href="#" class="sidebar-link" data-tab="contact">
                     <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    Li√™n H·ªá
                </a>

                <a href="game.html" class="sidebar-link">
                    <img src="https://icons.veryicon.com/png/o/miscellaneous/effevo/game-49.png" class="h-8 w-8 rounded-full">
                    Tr√≤ Ch∆°i
                </a>


                <a href="#" class="sidebar-link" data-tab="donate">
                    <img src="https://cdn-icons-png.flaticon.com/512/176/176696.png"class="h-8 w-8 rounded-full">
                    DONATE 
                </a>

            </nav>
        </div>
        
        <div class="p-4 mt-auto border-t border-main">
            <div id="auth-container" class="text-center">
                 <button id="login-btn" class="w-full btn-secondary bg-red-500 hover:bg-red-600 flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"/><path fill="#FF3D00" d="m6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691z"/><path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0 1 24 36c-5.218 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z"/><path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303c-.792 2.237-2.231 4.166-4.087 5.571l6.19 5.238C44.438 36.372 48 30.656 48 24c0-1.341-.138-2.65-.389-3.917z"/></svg>
                    <span>ƒêƒÉng nh·∫≠p v·ªõi Google</span>
                </button>
            </div>
            
            <div id="user-info" class="hidden items-center">
                <img id="user-avatar" class="w-10 h-10 rounded-full mr-3" src="" alt="User Avatar">
                <div class="text-sm">
                    <p id="user-name" class="font-semibold text-main-font"></p>
                    <button id="logout-btn" class="text-red-400 hover:text-red-300">ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
        </div>
    </aside>
    <div id="sidebar-backdrop" class="sidebar-backdrop md:hidden"></div>

    <div class="flex-1 md:ml-64 transition-all duration-300 min-h-screen p-4 sm:p-6 flex flex-col items-center">
        <header class="w-full max-w-4xl mx-auto p-4 flex flex-col sm:flex-row items-center justify-center text-center">
            <button id="open-sidebar-btn" class="md:hidden fixed top-4 left-4 z-40 p-2 bg-card-bg rounded-md text-main-font">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
            <img src="https://uploads.onecompiler.io/43u4wb3ft/43unfu266/Black%20and%20White%20Circle%20Class%20Logo.png" alt="Logo" class="h-24 w-24 mb-4 sm:mb-0 sm:mr-4 rounded-full">
            <div>
                <h1 class="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-cyan-300 py-2">QU·∫¢N L√ù TH√îNG TIN & ƒêI·ªÇM SV</h1>
                <p class="text-sm text-gray-400 mt-1">B·∫¢N TH·ª¨ NGHI·ªÜM C·ª¶A FOXSTUDIO</p>
            </div>
        </header>

        <main id="tab-content" class="w-full max-w-4xl mx-auto p-4 space-y-8">
            </main>

        <footer class="w-full max-w-4xl mx-auto mt-12 text-center text-main-font">
            <p class="text-sm text-slate-500">Ph√°t tri·ªÉn b·ªüi FOXSTUDIO.</p>
            <p class="text-sm text-slate-500">M·ªåI TH·∫ÆC M·∫ÆC LI√äN H·ªÜ : nguyenvanhai.10a3@gmail.</p>
        </footer>
    </div>

    <div class="fixed-buttons">
        <button id="openThemeModalBtn" class="p-3 rounded-full bg-yellow-500/80 shadow-lg cursor-pointer hover:bg-yellow-500 transition-all">
            <img src="https://png.pngtree.com/element_our/20200702/ourmid/pngtree-settings-icon-image_2290382.jpg" alt="Settings Icon" class="h-8 w-8 rounded-full">
        </button>

        <div id="chatbot-button" class="p-3 rounded-full bg-sky-500/80 shadow-lg cursor-pointer hover:bg-sky-500 transition-all">
            <img src="https://www.shutterstock.com/image-vector/chat-bot-icon-virtual-smart-600nw-2478937553.jpg" alt="Chatbot Icon" class="h-8 w-8 rounded-full">
        </div>
       
        <button id="openPrintModalBtn" class="btn-secondary bg-sky-500/80  rounded-full p-3 shadow-lg print-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
            </svg>
        </button>
    </div>

    <div id="printModal" class="modal">
        <div class="modal-content">
            <button id="closePrintModalBtn" class="modal-close-btn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 class="text-xl font-semibold text-accent mb-4">Ch·ªçn Sinh Vi√™n ƒë·ªÉ In</h3>
            <div id="printOptionsContainer" class="space-y-4 max-h-[70vh] overflow-y-auto pr-2"></div>
            <div class="mt-6 flex justify-end gap-3">
                <button id="printAllBtn" class="btn-primary">In T·∫•t C·∫£</button>
                <button id="printSelectedBtn" class="btn-primary" disabled>In ƒê√£ Ch·ªçn</button>
            </div>
        </div>
    </div>

    <div id="editStudentModal" class="modal">
        <div class="modal-content">
            <button id="closeEditStudentModalBtn" class="modal-close-btn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 class="text-xl font-semibold text-accent mb-4">Ch·ªânh S·ª≠a Th√¥ng Tin Sinh Vi√™n</h3>
            <form id="editStudentForm" class="space-y-4">
                <input type="hidden" id="editStudentId" />
                <div>
                    <label class="block text-sm font-medium text-main-font mb-1">H·ªç v√† T√™n</label>
                    <input type="text" id="editStudentName" class="input-style" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-main-font mb-1">M√£ S·ªë Sinh Vi√™n</label>
                    <input type="text" id="editStudentIdInp" class="input-style" disabled />
                </div>
                <div>
                    <label class="block text-sm font-medium text-main-font mb-1">L·ªõp</label>
                    <input type="text" id="editStudentClass" class="input-style" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-main-font mb-1">Khoa/Ng√†nh</label>
                    <input type="text" id="editStudentFaculty" class="input-style" />
                </div>
                <button type="submit" class="w-full btn-primary">L∆∞u Thay ƒê·ªïi</button>
            </form>
        </div>
    </div>

    <div id="themeModal" class="modal">
        <div class="modal-content">
            <button id="closeThemeModalBtn" class="modal-close-btn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 class="text-xl font-semibold text-accent mb-4">T√πy Ch·ªânh Giao Di·ªán</h3>
            <div class="space-y-4">
                <div>
                    <h4 class="text-lg font-medium text-main-font mb-2">Ch·∫ø ƒë·ªô giao di·ªán</h4>
                    <div class="flex gap-4">
                        <button id="lightModeBtn" class="btn-secondary w-full">S√°ng</button>
                        <button id="darkModeBtn" class="btn-secondary w-full">T·ªëi</button>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-medium text-main-font mb-2">M√†u ch·ªß ƒë·∫°o</h4>
                    <input type="color" id="accentColorPicker" class="w-full h-12 rounded-lg cursor-pointer p-1 border border-input-border" />
                </div>
                <div>
                    <h4 class="text-lg font-medium text-main-font mb-2">M√†u ch·ªØ</h4>
                    <input type="color" id="fontColorPicker" class="w-full h-12 rounded-lg cursor-pointer p-1 border border-input-border" />
                </div>
                 <div>
                    <h4 class="text-lg font-medium text-main-font mb-2">M√†u n·ªÅn th·∫ª</h4>
                    <input type="color" id="cardBgColorPicker" class="w-full h-12 rounded-lg cursor-pointer p-1 border border-input-border" />
                </div>
                <div>
                    <h4 class="text-lg font-medium text-main-font mb-2">·∫¢nh n·ªÅn</h4>
                    <input type="file" id="bgImageFile" accept="image/*" class="input-style">
                    <p class="text-sm text-slate-400 mt-2">Ch·ªçn m·ªôt ·∫£nh t·ª´ m√°y t√≠nh ƒë·ªÉ l√†m ·∫£nh n·ªÅn.</p>
                    <button id="removeBgBtn" class="w-full btn-outline-red mt-4">X√≥a ·∫£nh n·ªÅn</button>
                </div>
            </div>
        </div>
    </div>

    <div id="chatbot-window" class="chatbot-container">
        <div class="chatbot-header" id="chatbot-header">
            <span>Chatbot h·ªó tr·ª£</span>
            <button id="close-chatbot-btn" class="p-1 rounded-full hover:bg-white/20 transition-all duration-200">
                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div class="chatbot-messages" id="chatbot-messages">
            <div class="message bot-message">Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n v·ªÅ ·ª©ng d·ª•ng n√†y?</div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbot-input-field" class="input-style flex-grow" placeholder="Nh·∫≠p tin nh·∫Øn..." />
            <button id="send-btn" class="p-2 rounded-full bg-sky-500 text-white hover:bg-sky-600 transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                </svg>
            </button>
        </div>
    </div>

    <div id="printContent" style="display: none;"></div>

    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <script>
        
        const firebaseConfig = {
            apiKey: "AIzaSyA6MzA5S1JxABA6PPsiH1dV_JjMpoqkxIM",
            authDomain: "quan-ly-sinh-vien-e3307.firebaseapp.com",
            projectId: "quan-ly-sinh-vien-e3307",
            storageBucket: "quan-ly-sinh-vien-e3307.appspot.com",
            messagingSenderId: "1021646737843",
            appId: "1:1021646737843:web:7edb6d3be5257c4d10fbc6"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const studentsCollection = db.collection('students');

        firebase.auth().useDeviceLanguage();

        
        const THEME_KEY = 'student-app:theme';
        const BG_KEY = 'student-app:background';
        const ACCENT_KEY = 'student-app:accent';
        const FONT_COLOR_KEY = 'student-app:font-color';
        const CARD_BG_KEY = 'student-app:card-bg';
      

        let students = [];
        let isLoggedIn = false;

       
        function applyTheme(theme) {
            const body = document.body;
            if (theme === 'light') { body.classList.add('light-mode'); }
            else { body.classList.remove('light-mode'); }
            localStorage.setItem(THEME_KEY, theme);
        }
        function loadTheme() { applyTheme(localStorage.getItem(THEME_KEY) || 'dark'); }
        function applyAccentColor(color) {
            document.documentElement.style.setProperty('--accent-color', color);
            localStorage.setItem(ACCENT_KEY, color);
        }
        function loadAccentColor() {
            const savedColor = localStorage.getItem(ACCENT_KEY) || '#0ea5e9';
            applyAccentColor(savedColor);
            const accentColorPicker = document.getElementById('accentColorPicker');
            if(accentColorPicker) accentColorPicker.value = savedColor;
        }
        function applyFontColor(color) {
            document.documentElement.style.setProperty('--main-font-color', color);
            localStorage.setItem(FONT_COLOR_KEY, color);
        }
        function loadFontColor() {
            const savedColor = localStorage.getItem(FONT_COLOR_KEY) || 'var(--text-color)';
            applyFontColor(savedColor);
            const fontColorPicker = document.getElementById('fontColorPicker');
            if(fontColorPicker) fontColorPicker.value = savedColor;
        }
        function applyCardBgColor(color) {
             document.documentElement.style.setProperty('--card-bg', color);
            localStorage.setItem(CARD_BG_KEY, color);
        }
        function loadCardBgColor() {
            const savedColor = localStorage.getItem(CARD_BG_KEY) || '#1e293b';
            applyCardBgColor(savedColor);
            const cardBgColorPicker = document.getElementById('cardBgColorPicker');
            if(cardBgColorPicker) cardBgColorPicker.value = savedColor;
        }
        function applyBackground(url) {
            const body = document.body;
            if (url) {
                body.style.backgroundImage = `url('${url}')`;
                body.classList.add('custom-bg');
                localStorage.setItem(BG_KEY, url);
            } else {
                body.style.backgroundImage = '';
                body.classList.remove('custom-bg');
                localStorage.removeItem(BG_KEY);
            }
        }
        function loadBackground() {
            const savedBg = localStorage.getItem(BG_KEY);
            if (savedBg) { applyBackground(savedBg); }
        }
        function avgToLetter(d){if(d>=10)return'A';else if(d>=9)return'A';else if(d>=8.5)return'A';else if(d>=7.8)return'B+';else if(d>=7.0)return'B';else if(d>=6.3)return'C+';else if(d>=5.5)return'C';else if(d>=4.8)return'D+';else if(d>=4.0)return'D';return'F';}
        function avgToPoint4(d){if(d>=10)return 4.0;else if(d>=7.8)return 3.5;else if(d>=7.0)return 3.0;else if(d>=6.3)return 2.5;else if(d>=5.5)return 2.0;else if(d>=4.8)return 1.5;else if(d>=4.0)return 1.;return 0.0;}
        function gradeToPoint(g){const t=String(g).toUpperCase().trim(),e=parseFloat(t);if(!isNaN(e)&&e>=0&&e<=4)return e;switch(t){case"A":return 4;case"B+":return 3.5;case"B":return 3;case"C+":return 2.5;case"C":return 2;case"D+":return 1.5;case"D":return 1;case"F":return 0;default:return NaN}}

        function computeGPA(studentCourses) {
            if (!Array.isArray(studentCourses) || studentCourses.length === 0) {
                return 0;
            }
            let totalPoints = 0, totalCredits = 0;
            studentCourses.forEach(c => {
                const cred = parseFloat(c.credits);
                const point = (typeof c.point4 === 'number') ? c.point4 : gradeToPoint(c.grade);
                if (!isNaN(cred) && cred > 0 && !isNaN(point)) {
                    totalPoints += point * cred;
                    totalCredits += cred;
                }
            });
            return totalCredits === 0 ? 0 : (totalPoints / totalCredits);
        }

        const tabContentHtml = {
            'intro': `
                <section id="intro" class="content-section active bg-card-bg shadow-2xl rounded-xl p-6">
                    <h2 class="text-2xl font-semibold mb-6 text-accent">Gi·ªõi Thi·ªáu</h2>
                    <div class="space-y-4 text-main-font">
                        <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi ·ª©ng d·ª•ng qu·∫£n l√Ω sinh vi√™n c·ªßa FOXSTUDIO. D·ªØ li·ªáu tr√™n trang n√†y ƒë∆∞·ª£c ƒë·ªìng b·ªô cho t·∫•t c·∫£ ng∆∞·ªùi d√πng.</p>
                        <p>B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ c√≥ th·ªÉ th·ª±c hi·ªán c√°c thao t√°c Th√™m, S·ª≠a, X√≥a.</p>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-xl font-semibold mb-4 text-main-font">Th·ªëng k√™ nhanh</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                            <div class="bg-slate-700/50 p-4 rounded-lg"><p class="text-sm text-slate-400">T·ªïng s·ªë sinh vi√™n</p><p id="totalStudents" class="text-3xl font-bold text-accent">0</p></div>
                            <div class="bg-slate-700/50 p-4 rounded-lg"><p class="text-sm text-slate-400">T·ªïng s·ªë t√≠n ch·ªâ</p><p id="totalCredits" class="text-3xl font-bold text-accent">0</p></div>
                            <div class="bg-slate-700/50 p-4 rounded-lg"><p class="text-sm text-slate-400">GPA trung b√¨nh</p><p id="avgGpa" class="text-3xl font-bold text-accent">0.00</p></div>
                        </div>
                    </div>
                    <div class="qr-code-section flex flex-col sm:flex-row items-center justify-center gap-6 mt-10">
                        <img src="https://uploads.onecompiler.io/43u4wb3ft/43unfu266/APPTTSV.png" alt="QR Code" class="h-[150px] w-[150px] rounded-xl">
                        <h2 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-cyan-300">QU√âT QR CODE NGAY ƒê·ªÇ <br class="hidden sm:block"> T·∫¢I APP MOBILE.</h2>
                    </div>
                </section>`,
            'add-student': `
                <section id="add-student" class="content-section bg-card-bg shadow-2xl rounded-xl p-6">
                    <h2 class="text-2xl font-semibold mb-6 text-accent">Th√™m Sinh Vi√™n M·ªõi</h2>
                    <form id="studentForm" class="space-y-3">
                        <div><label class="block text-sm font-medium text-main-font mb-1">H·ªç v√† T√™n</label><input type="text" id="newStudentName" class="input-style" placeholder="Nguy·ªÖn VƒÉn A" required /></div>
                        <div><label class="block text-sm font-medium text-main-font mb-1">M√£ S·ªë Sinh Vi√™n</label><input type="text" id="newStudentId" class="input-style" placeholder="20201234" required /></div>
                        <div><label class="block text-sm font-medium text-main-font mb-1">L·ªõp</label><input type="text" id="newStudentClass" class="input-style" placeholder="CNTT-K65" /></div>
                        <div><label class="block text-sm font-medium text-main-font mb-1">Khoa/Ng√†nh</label><input type="text" id="newStudentFaculty" class="input-style" placeholder="C√¥ng ngh·ªá Th√¥ng tin" /></div>
                        <p id="studentError" class="text-red-400 text-sm"></p>
                        <div class="pt-2"><button type="submit" class="w-full btn-primary" id="btnAddNewStudent"><img src="https://cdn-icons-png.flaticon.com/512/992/992651.png" class="w-5 h-5"><span class="ml-2">Th√™m Sinh Vi√™n</span></button></div>
                    </form>
                </section>`,
            'student-list': `
                <section id="student-list" class="content-section">
                    <div class="bg-card-bg shadow-2xl rounded-xl p-6 mb-6">
                        <h2 class="text-2xl font-semibold mb-6 text-accent">Qu·∫£n L√Ω Sinh Vi√™n</h2>
                        <div class="mb-6"><input type="text" id="searchInput" class="input-style" placeholder="üîç T√¨m ki·∫øm theo t√™n ho·∫∑c MSSV..."></div>
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                            <div class="flex items-center gap-2">
                                <label for="sortOrder" class="text-sm font-medium text-main-font">S·∫Øp x·∫øp theo:</label>
                                <select id="sortOrder" class="input-style-sm"><option value="name-asc">T√™n (A-Z)</option><option value="name-desc">T√™n (Z-A)</option><option value="gpa-desc">GPA (Cao - Th·∫•p)</option><option value="gpa-asc">GPA (Th·∫•p - Cao)</option></select>
                            </div>
                        </div>
                    </div>
                    <div id="studentsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </section>`,
            'contact': `
                <section id="contact" class="content-section bg-card-bg shadow-2xl rounded-xl p-6">
                    <h2 class="text-2xl font-semibold mb-6 text-accent">Li√™n H·ªá</h2>
                    <p class="text-sm text-main-font mb-4">K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i qua c√°c k√™nh sau ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ v√† c·∫≠p nh·∫≠t th√¥ng tin m·ªõi nh·∫•t!</p>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <a href="https://www.facebook.com/nguyen.hai.225063" target="_blank" rel="noopener" class="w-full btn-outline-blue flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.58-1.333h2.42v-4h-3.998c-2.761 0-4.002 1.147-4.002 3.205v1.795z"/></svg><span>Li√™n h·ªá Facebook</span></a>
                        <a href="mailto:nguyenvanhai.10a3@gmail.com" class="w-full btn-outline-red flex items-center justify-center"><img src="https://png.pngtree.com/element_our/png/20181213/inbox-vector-icon-png_267453.jpg" alt="Email Icon" class="w-6 h-6 mr-2 rounded-full" ><span>G·ª≠i Email</span></a>
                    </div>
                </section>
                <section class="bg-card-bg shadow-2xl rounded-xl p-6">
                    <div class="flex items-center mb-4"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-6 h-6 mr-2 text-red-500" viewBox="0 0 24 24"><path d="M21.582,6.186c-0.23-0.86-0.908-1.538-1.768-1.768C18.25,4,12,4,12,4S5.75,4,4.186,4.418 c-0.86,0.23-1.538,0.908-1.768,1.768C2,7.75,2,12,2,12s0,4.25,0.418,5.814c0.23,0.86,0.908,1.538,1.768,1.768 C5.75,20,12,20,12,20s6.25,0,7.814-0.418c0.861-0.23,1.538-0.908,1.768-1.768C22,16.25,22,12,22,12S22,7.75,21.582,6.186z M10,15.5v-7l6,3.5L10,15.5z"/></svg><h2 class="text-2xl font-semibold text-red-500">K√™nh YouTube ƒê·ªÅ Xu·∫•t</h2></div>
                    <div><h3 class="text-xl font-semibold text-accent" id="ytName">K√™nh YouTube c·ªßa FOX</h3><p class="text-sm text-main-font mt-1 mb-3" id="ytDesc">N∆°i chia s·∫ª nh·ªØng video h·ªØu √≠ch v√† th√∫ v·ªã. H√£y gh√© thƒÉm v√† ·ªßng h·ªô nh√©!</p><a id="ytUrl" href="https://www.youtube.com/channel/UCSRG41tE6J27W5SCsAVahGw" target="_blank" rel="noopener" class="btn-outline-red">Xem K√™nh v√† ƒêƒÉng k√Ω</a></div>
                </section>
                <section class="bg-card-bg shadow-2xl rounded-xl p-6">
                    <div class="flex items-center mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A11.978 11.978 0 0 1 12 13.5c-2.998 0-5.74-1.1-7.843-2.918M3.284 9.747c0-.778.099-1.533.284-2.253" /></svg><h2 class="text-2xl font-semibold text-blue-500">Website c·ªßa tr∆∞·ªùng </h2></div>
                    <div><h3 class="text-xl font-semibold text-accent" id="webName">TRANG TT C·ª¶A TR∆Ø·ªúNG ƒêH PH·∫†M VƒÇN ƒê·ªíNG</h3><p class="text-sm text-main-font mt-1 mb-3" id="webDesc">Kh√°m ph√° nh·ªØng ki·∫øn th·ª©c b·ªï √≠ch v√† c√¥ng c·ª• h·ªçc t·∫≠p tuy·ªát v·ªùi t·∫°i ƒë√¢y!</p><a id="webUrl" href="https://www.pdu.edu.vn/" target="_blank" rel="noopener" class="btn-outline-blue">Truy c·∫≠p Website</a></div>
                </section>`,

                'donate': `
                <section id="intro" class="content-section active bg-card-bg shadow-2xl rounded-xl p-6">
                    <h2 class="text-2xl font-semibold mb-6 text-accent"> TH√îNG TIN DONATE </h2>
                    <div class="space-y-4 text-main-font">
                        <p> AI C√ì L√íNG H·∫¢O T√ÇM TH√å DONATE CHO FOXST ƒê·ªÇ FOXST C√ì KINH PH√ç DUY TR√å WEB ·∫† , TK M·ªåI NG∆Ø·ªúI üòçüòçüòç.</p>
                    </div>
    
                    <div class="qr-code-section flex flex-col sm:flex-row items-center justify-center gap-6 mt-10">
                        <img src="https://uploads.onecompiler.io/43u4wb3ft/43zhnjy7e/IMG_20251013_215110%5B1%5D(1).jpg" alt="QR Code" class="h-[150px] w-[150px] rounded-xl">
                        <h2 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-cyan-300">QU√âT QR CODE NGAY ƒê·ªÇ  <br class="hidden sm:block"> DONATE .</h2>
                    </div>
                </section>`,

            
        };

       

        function setupRealtimeListener() {
            studentsCollection.onSnapshot(snapshot => {
                const updatedStudents = [];
                snapshot.forEach(doc => {
                    updatedStudents.push({ id: doc.id, ...doc.data() });
                });

                students = updatedStudents;
                renderStudents();
                updateDashboard();
                console.log("D·ªØ li·ªáu ƒë∆∞·ª£c c·∫≠p nh·∫≠t Real-time!");
            }, error => {
                console.error("L·ªói khi l·∫Øng nghe d·ªØ li·ªáu Firebase: ", error);
            });
        }

        function addNewStudent(e) {
            e.preventDefault();
            if (!isLoggedIn) {
                console.error("L·ªói: Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m sinh vi√™n.");
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m sinh vi√™n.");
                return;
            }

            const studentError = document.getElementById('studentError');
            const newStudentId = document.getElementById('newStudentId').value.trim();
            const existingStudent = students.find(s => s.studentId === newStudentId);

            if (existingStudent) {
                studentError.textContent = 'M√£ s·ªë sinh vi√™n ƒë√£ t·ªìn t·∫°i.';
                return;
            }

            const newStudentData = {
                name: document.getElementById('newStudentName').value,
                studentId: newStudentId,
                class: document.getElementById('newStudentClass').value,
                faculty: document.getElementById('newStudentFaculty').value,
                courses: []
            };

            studentsCollection.add(newStudentData).then(() => {
                console.log('Th√™m sinh vi√™n m·ªõi th√†nh c√¥ng!');
                document.getElementById('studentForm').reset();
                studentError.textContent = '';
            }).catch(error => {
                console.error("L·ªói khi th√™m sinh vi√™n: ", error);
                alert('C√≥ l·ªói x·∫£y ra, kh√¥ng th·ªÉ th√™m sinh vi√™n.');
            });
        }

        function updateStudentData(studentId, updatedData) {
            if (!isLoggedIn) { alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠a ƒë·ªïi."); return; }
            studentsCollection.doc(studentId).update(updatedData).catch(error => {
                console.error("L·ªói khi c·∫≠p nh·∫≠t: ", error);
            });
        }

        function deleteStudent(studentId) {
            if (!isLoggedIn) { alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ x√≥a."); return; }
             if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a sinh vi√™n n√†y? Thao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
                studentsCollection.doc(studentId).delete().catch(error => {
                    console.error("L·ªói khi x√≥a sinh vi√™n: ", error);
                });
            }
        }

        
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            provider.addScope('email');

            
            auth.signInWithPopup(provider)
                .then((result) => {
                    console.log("ƒêƒÉng nh·∫≠p b·∫±ng Pop-up th√†nh c√¥ng!", result.user.displayName);
                })
                .catch((error) => {
                    if (error.code === 'auth/popup-closed-by-user' || error.code === 'auth/cancelled-popup-request') {
                         console.warn("Ng∆∞·ªùi d√πng ƒë√£ ƒë√≥ng ho·∫∑c h·ªßy y√™u c·∫ßu ƒëƒÉng nh·∫≠p.");
                    } else {
                        console.error("ƒêƒÉng nh·∫≠p th·∫•t b·∫°i:", error.code, error.message);
                        alert(`ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: ${error.message}.`);
                    }
                });
        }

        function signOut() {
            auth.signOut().then(() => {
                
            }).catch(error => console.error("ƒêƒÉng xu·∫•t th·∫•t b·∫°i:", error));
        }
        
        
        function handleAuthStateChange(user) {
            const authContainer = document.getElementById('auth-container');
            const userInfo = document.getElementById('user-info');
            const userAvatar = document.getElementById('user-avatar'); 

            isLoggedIn = !!user; 

            if (user) {
              
                authContainer.classList.add('hidden');
                
               
                userInfo.classList.remove('hidden');
                userInfo.style.display = 'flex'; 

                
                userAvatar.src = user.photoURL;
                
               
                userAvatar.onerror = function() {
                    userAvatar.src = 'https://img.icons8.com/material-rounded/48/user--v1.png'; 
                    userAvatar.onerror = null; 
                };

                document.getElementById('user-name').textContent = user.displayName || 'Ng∆∞·ªùi d√πng';
            } else {
                
                authContainer.classList.remove('hidden');
                userInfo.classList.add('hidden');
                userInfo.style.display = 'none'; 
              
                userAvatar.src = '';
                userAvatar.onerror = null;
            }

           
            const currentTab = document.querySelector('.sidebar-link.active')?.dataset.tab;
            if (currentTab === 'student-list') {
                renderStudents(); 
            }
            if (currentTab === 'add-student') {
                const addStudentBtn = document.getElementById('btnAddNewStudent');
                if (addStudentBtn) {
                    isLoggedIn ? addStudentBtn.classList.remove('disabled') : addStudentBtn.classList.add('disabled');
                }
            }
        }


        

        function switchTab(tabName) {
            document.querySelectorAll('.sidebar-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById('tab-content').innerHTML = tabContentHtml[tabName];

            if (tabName === 'intro') {
                updateDashboard();
            } else if (tabName === 'student-list') {
                const searchInput = document.getElementById('searchInput');
                document.getElementById('sortOrder').addEventListener('change', (e) => sortStudents(e.target.value));
                searchInput.addEventListener('input', () => {
                    const searchTerm = searchInput.value.toLowerCase().trim();
                    const filteredStudents = students.filter(student =>
                        student.name.toLowerCase().includes(searchTerm) ||
                        student.studentId.toLowerCase().includes(searchTerm)
                    );
                    renderStudents(filteredStudents);
                });
                renderStudents(); 
            } else if (tabName === 'add-student') {
                document.getElementById('studentForm').addEventListener('submit', addNewStudent);
                const addStudentBtn = document.getElementById('btnAddNewStudent');
             
                if (addStudentBtn) {
                    isLoggedIn ? addStudentBtn.classList.remove('disabled') : addStudentBtn.classList.add('disabled');
                }
            }
        }

        function attachEventListeners() {
           
            const studentsContainer = document.getElementById('studentsContainer');
            if(studentsContainer) {
                const clone = studentsContainer.cloneNode(true);
                studentsContainer.parentNode.replaceChild(clone, studentsContainer);
                
            }


           
            document.querySelectorAll('[data-edit-student]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    if (!isLoggedIn) { alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠a."); return; }
                    const studentId = e.currentTarget.getAttribute('data-edit-student');
                    const studentToEdit = students.find(s => s.id === studentId);
                    if (studentToEdit) {
                        document.getElementById('editStudentId').value = studentToEdit.id;
                        document.getElementById('editStudentName').value = studentToEdit.name;
                        document.getElementById('editStudentIdInp').value = studentToEdit.studentId;
                        document.getElementById('editStudentClass').value = studentToEdit.class;
                        document.getElementById('editStudentFaculty').value = studentToEdit.faculty;
                        document.getElementById('editStudentModal').classList.add('show');
                    }
                });
            });

            document.querySelectorAll('[data-del-student]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const studentId = e.currentTarget.getAttribute('data-del-student');
                    deleteStudent(studentId);
                });
            });

            document.querySelectorAll('[data-del-course]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    if (!isLoggedIn) { alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ x√≥a m√¥n h·ªçc."); return; }
                    const courseId = e.currentTarget.getAttribute('data-del-course');
                    const studentCard = e.currentTarget.closest('.student-card');
                    const studentId = studentCard.querySelector('.course-form')?.getAttribute('data-student-id');
                    const student = students.find(s => s.id === studentId);
                    if (student) {
                        if (!Array.isArray(student.courses)) student.courses = [];
                        student.courses = student.courses.filter(c => c.id !== courseId);
                        updateStudentData(student.id, { courses: student.courses });
                    }
                });
            });

            document.querySelectorAll('.toggleDetailed').forEach(toggle => {
                toggle.addEventListener('change', (e) => {
                    const form = e.currentTarget.closest('.course-form');
                    const simpleArea = form.querySelector('.simpleGradeArea');
                    const detailedArea = form.querySelector('.detailedArea');
                    if (e.currentTarget.checked) {
                        simpleArea.classList.add('hidden');
                        detailedArea.classList.remove('hidden');
                    } else {
                        detailedArea.classList.add('hidden');
                        simpleArea.classList.remove('hidden');
                    }
                });
            });

            document.querySelectorAll('.detailedArea input[type="number"]').forEach(input => {
                input.addEventListener('input', (e) => {
                    const form = e.currentTarget.closest('.course-form');
                    const hs1 = parseFloat(form.querySelector('.hs1Inp').value) || 0;
                    const hs2 = parseFloat(form.querySelector('.hs2Inp').value) || 0;
                    const thi = parseFloat(form.querySelector('.thiInp').value) || 0;
                    const avg = (hs1 + hs2 * 2 + thi * 3) / 6;
                    const grade = avgToLetter(avg);
                    const point4 = avgToPoint4(avg);
                    const detailedResult = form.querySelector('.detailedResult');
                    detailedResult.innerHTML = `<p>ƒêi·ªÉm trung b√¨nh (h·ªá 10): <strong>${avg.toFixed(2)}</strong></p><p>ƒêi·ªÉm ch·ªØ: <strong>${grade}</strong></p><p>ƒêi·ªÉm h·ªá 4: <strong>${point4.toFixed(1)}</strong></p>`;
                    detailedResult.classList.remove('hidden');
                });
            });

            document.querySelectorAll('.course-form').forEach(form => {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (!isLoggedIn) { alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m m√¥n h·ªçc."); return; }
                    const studentId = e.target.getAttribute('data-student-id');
                    const student = students.find(s => s.id === studentId);
                    if (!student) return;
                    const courseError = e.target.querySelector('.course-error');
                    courseError.textContent = '';
                    let newCourse = {
                        id: 'c-' + Date.now(),
                        name: e.target.querySelector('.courseNameInp').value,
                        credits: parseFloat(e.target.querySelector('.creditsInp').value),
                    };
                    const isDetailed = e.target.querySelector('.toggleDetailed').checked;
                    if (isDetailed) {
                        const hs1 = parseFloat(e.target.querySelector('.hs1Inp').value);
                        const hs2 = parseFloat(e.target.querySelector('.hs2Inp').value);
                        const thi = parseFloat(e.target.querySelector('.thiInp').value);
                        if(isNaN(hs1)||isNaN(hs2)||isNaN(thi)){courseError.textContent='Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß c√°c ƒëi·ªÉm chi ti·∫øt.';return}
                        const avg = (hs1 + hs2 * 2 + thi * 3) / 6;
                        newCourse = { ...newCourse, hs1, hs2, thi, avg, grade: avgToLetter(avg), point4: avgToPoint4(avg) };
                    } else {
                        const gradeValue = e.target.querySelector('.gradeInput').value.trim();
                        const avgValue = e.target.querySelector('.avgInput').value.trim();
                        if(!gradeValue&&!avgValue){courseError.textContent='Vui l√≤ng nh·∫≠p ƒëi·ªÉm t·ªïng k·∫øt ho·∫∑c ƒëi·ªÉm h·ªçc ph·∫ßn.';return}
                        if (gradeValue) {
                            const point4 = gradeToPoint(gradeValue);
                            if(isNaN(point4)){courseError.textContent='ƒêi·ªÉm ch·ªØ kh√¥ng h·ª£p l·ªá.';return}
                            newCourse = { ...newCourse, grade: gradeValue, point4 };
                        } else if (avgValue) {
                            const avg = parseFloat(avgValue);
                            if(isNaN(avg)||avg<0||avg>10){courseError.textContent='ƒêi·ªÉm h·ªçc ph·∫ßn kh√¥ng h·ª£p l·ªá.';return}
                            newCourse = { ...newCourse, avg, grade: avgToLetter(avg), point4: avgToPoint4(avg) };
                        }
                    }

                    if (!student.courses || !Array.isArray(student.courses)) {
                        student.courses = [];
                    }
                    student.courses.push(newCourse);

                    updateStudentData(student.id, { courses: student.courses });
                    form.reset();
                    courseError.textContent = '';
                });
            });
        }
        function updateDashboard() {
            const totalStudentsEl = document.getElementById('totalStudents');
            const totalCreditsEl = document.getElementById('totalCredits');
            const avgGpaEl = document.getElementById('avgGpa');
            if (!totalStudentsEl) return;
            const totalStudents = students.length;
            let totalCredits = 0;
            let totalGpaPoints = 0;
            students.forEach(student => {
                if (student.courses && Array.isArray(student.courses)) {
                    student.courses.forEach(course => {
                        totalCredits += parseFloat(course.credits) || 0;
                    });
                }
                totalGpaPoints += computeGPA(student.courses || []);
            });
            const avgGpa = totalStudents > 0 ? (totalGpaPoints / totalStudents) : 0;
            totalStudentsEl.textContent = totalStudents;
            totalCreditsEl.textContent = totalCredits;
            avgGpaEl.textContent = avgGpa.toFixed(2);
        }

        function sortStudents(sortType) {
            let studentsToSort = [...students];
            switch(sortType) {
                case 'name-asc': studentsToSort.sort((a, b) => a.name.localeCompare(b.name)); break;
                case 'name-desc': studentsToSort.sort((a, b) => b.name.localeCompare(a.name)); break;
                case 'gpa-desc': studentsToSort.sort((a, b) => computeGPA(b.courses) - computeGPA(a.courses)); break;
                case 'gpa-asc': studentsToSort.sort((a, b) => computeGPA(a.courses) - computeGPA(b.courses)); break;
            }
            renderStudents(studentsToSort);
        }

        function renderStudents(studentsToRender = students) {
            const studentsContainer = document.getElementById('studentsContainer');
            if (!studentsContainer) return;
            studentsContainer.innerHTML = '';
            if (studentsToRender.length === 0) {
                studentsContainer.innerHTML = `<p class="text-main-font text-center py-10 w-full col-span-full">Ch∆∞a c√≥ sinh vi√™n n√†o ho·∫∑c kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£.</p>`;
                return;
            }
            studentsToRender.forEach(student => {
                const totalCredits = (student.courses || []).reduce((sum, course) => sum + (parseFloat(course.credits) || 0), 0);
                const gpa = computeGPA(student.courses);
                const status = gpa >= 2.0 ? 'ƒê·∫≠u' : 'Tr∆∞·ª£t';
                const statusColor = gpa >= 2.0 ? 'text-emerald-400' : 'text-red-400';

               
                const controlsVisibilityClass = isLoggedIn ? '' : 'hidden';

                const cardHtml = `
                    <div class="student-card bg-card-bg shadow-2xl rounded-xl p-6 relative">
                        <div class="flex items-center absolute top-2 right-2 ${controlsVisibilityClass}">
                            <button class="btn-icon-edit" data-edit-student="${student.id}" title="Ch·ªânh s·ª≠a"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg></button>
                            <button class="btn-icon-danger" data-del-student="${student.id}" title="X√≥a"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg></button>
                        </div>
                        <div class="mb-6 pb-4 border-b border-border-color">
                            <h3 class="text-xl font-semibold text-accent">${student.name}</h3>
                             <p class="text-sm text-main-font">MSSV: ${student.studentId}</p>
                             <p class="text-sm text-main-font">L·ªõp: ${student.class || 'N/A'}</p>
                             <p class="text-sm text-main-font">Khoa: ${student.faculty || 'N/A'}</p>

                             <div class="mt-4 grid grid-cols-2 gap-2 text-center">
                                <div class="bg-slate-700/50 px-4 py-2 rounded-lg shadow">
                                    <span class="text-main-font font-medium block text-sm opacity-75">GPA</span>
                                    <span class="text-2xl font-bold text-emerald-400">${gpa.toFixed(2)}</span>
                                </div>
                                <div class="bg-slate-700/50 px-4 py-2 rounded-lg shadow">
                                    <span class="text-main-font font-medium block text-sm opacity-75">T√≠n ch·ªâ T.L≈©y</span>
                                    <span class="text-2xl font-bold text-sky-400">${totalCredits}</span>
                                </div>
                             </div>
                             <div class="mt-2 text-center">
                                <span class="text-lg font-bold ${statusColor}">${status}</span>
                             </div>
                        </div>
                        <div class="space-y-4 mb-6 ${controlsVisibilityClass}">
                            <h4 class="text-lg font-semibold text-accent">Th√™m M√¥n H·ªçc</h4>
                            <form class="course-form" data-student-id="${student.id}">
                                <div><label class="block text-sm font-medium text-main-font mb-1">T√™n M√¥n H·ªçc</label><input type="text" class="courseNameInp input-style" placeholder="VD: L·∫≠p tr√¨nh Web" required /></div>
                                <div><label class="block text-sm font-medium text-main-font mb-1">S·ªë T√≠n Ch·ªâ</label><input type="number" class="creditsInp input-style" placeholder="VD: 3" min="0.5" step="0.5" required /></div>
                                <div class="flex items-center space-x-2 pt-2"><input type="checkbox" class="toggleDetailed h-4 w-4 rounded border-slate-600 text-accent focus:ring-accent"/><label class="text-sm font-medium text-main-font">T√≠nh ƒëi·ªÉm chi ti·∫øt</label></div>
                                <div class="simpleGradeArea space-y-3">
                                    <div><label class="block text-sm font-medium text-main-font mb-1">ƒêi·ªÉm T·ªïng K·∫øt (A-F, 0-4)</label><input type="text" class="gradeInput input-style" placeholder="VD: A, B+, 3.0" /></div>
                                    <div><label class="block text-sm font-medium text-main-font mb-1">ƒêi·ªÉm H·ªçc Ph·∫ßn (0-10)</label><input type="number" class="avgInput input-style" placeholder="VD: 7.8" step="0.1" min="0" max="10" /></div>
                                </div>
                                <div class="detailedArea space-y-4 p-4 border border-slate-700 rounded-lg mt-2 bg-slate-800/50 hidden">
                                    <h5 class="text-base font-semibold text-accent mb-3">Chi Ti·∫øt ƒêi·ªÉm</h5>
                                    <div class="grid grid-cols-3 gap-3">
                                        <div><label class="block text-xs text-main-font mb-1">HS1</label><input type="number" step="0.1" min="0" max="10" class="hs1Inp input-style-sm" placeholder="VD: 7.0" /></div>
                                        <div><label class="block text-xs text-main-font mb-1">HS2</label><input type="number" step="0.1" min="0" max="10" class="hs2Inp input-style-sm" placeholder="VD: 8.0" /></div>
                                        <div><label class="block text-xs text-main-font mb-1">ƒêi·ªÉm Thi</label><input type="number" step="0.1" min="0" max="10" class="thiInp input-style-sm" placeholder="VD: 7.5" /></div>
                                    </div>
                                    <div class="detailedResult mt-3 p-3 bg-slate-700/50 rounded-md text-sm hidden"></div>
                                </div>
                                <p class="course-error text-red-400 text-sm mt-1"></p>
                                <button type="submit" class="w-full btn-primary mt-2">Th√™m M√¥n</button>
                            </form>
                        </div>
                        <div class="course-table-wrap">${renderCourseTable(student.courses)}</div>
                    </div>`;
                studentsContainer.innerHTML += cardHtml;
            });
            attachEventListeners();
        }

        function renderCourseTable(courses, forPrint = false) {
            if (!courses || !courses.length) {
                return `<p class="text-main-font text-center py-4">Ch∆∞a c√≥ m√¥n h·ªçc n√†o.</p>`;
            }
            const rows = courses.map(c => `
                <tr class="border-b ${forPrint ? 'border-gray-300' : 'border-slate-700 hover:bg-slate-700/50'}">
                    <td class="${forPrint ? '' : 'td-style'}">${c.name}</td>
                    <td class="${forPrint ? '' : 'td-style'} text-center">${c.credits}</td>
                    <td class="${forPrint ? '' : 'td-style'} text-center">${(typeof c.hs1 === 'number')?c.hs1.toFixed(1):'-'}</td>
                    <td class="${forPrint ? '' : 'td-style'} text-center">${(typeof c.hs2 === 'number')?c.hs2.toFixed(1):'-'}</td>
                    <td class="${forPrint ? '' : 'td-style'} text-center">${(typeof c.thi === 'number')?c.thi.toFixed(1):'-'}</td>
                    <td class="${forPrint ? '' : 'td-style'} text-center">${(typeof c.avg === 'number')?c.avg.toFixed(2):'-'}</td>
                    <td class="${forPrint ? '' : 'td-style'} text-center">${c.grade||'-'}</td>
                    <td class="${forPrint ? '' : 'td-style'} text-center">${(typeof c.point4==='number')?c.point4.toFixed(1):((gradeToPoint(c.grade)??NaN)||0).toFixed(1)}</td>
                    <td class="${(forPrint || !isLoggedIn) ?'hidden':'td-style text-center'}"><button class="btn-icon-danger" data-del-course="${c.id}" title="X√≥a m√¥n n√†y"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12.56 0c.342.052.682.107 1.022.166m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg></button></td>
                </tr>`).join('');
            return `<div class="course-table-wrap"><table class="w-full min-w-max text-left"><thead><tr class="border-b border-border-color"><th class="${forPrint?'':'th-style'}">T√™n M√¥n</th><th class="${forPrint?'':'th-style'} text-center">T√≠n Ch·ªâ</th><th class="${forPrint?'':'th-style'} text-center">HS1</th><th class="${forPrint?'':'th-style'} text-center">HS2</th><th class="${forPrint?'':'th-style'} text-center">ƒêi·ªÉm Thi</th><th class="${forPrint?'':'th-style'} text-center">ƒêi·ªÉm HP</th><th class="${forPrint?'':'th-style'} text-center">Ch·ªØ</th><th class="${forPrint?'':'th-style'} text-center">H·ªá 4</th><th class="${(forPrint || !isLoggedIn)?'hidden':'th-style text-center'}">H√†nh ƒê·ªông</th></tr></thead><tbody>${rows}</tbody></table></div>`;
        }

        function renderPrintOptions(){const t=document.getElementById("printOptionsContainer");if(!t)return;t.innerHTML="",students.forEach(e=>{t.innerHTML+=`<div class="flex items-center space-x-3"><input type="checkbox" class="print-checkbox h-5 w-5 rounded border-slate-600 text-accent focus:ring-accent" data-student-id="${e.id}" /><label class="text-main-font font-medium">${e.name} - ${e.studentId}</label></div>`});const e=t.querySelectorAll(".print-checkbox"),n=document.getElementById("printSelectedBtn");n&&(e.forEach(t=>t.addEventListener("change",()=>{n.disabled=!Array.from(e).some(t=>t.checked)})),n.disabled=!Array.from(e).some(t=>t.checked))}
        function createPrintContent(t){const e=document.getElementById("printContent");if(!e)return;e.innerHTML="",t.forEach(t=>{const n=computeGPA(t.courses);e.innerHTML+=`<div class="print-page p-6 mb-6"><div class="print-info"><h3 class="text-xl font-semibold">H·ªç v√† T√™n: <strong>${t.name}</strong></h3><p><strong>M√£ S·ªë Sinh Vi√™n:</strong> ${t.studentId}</p><p><strong>L·ªõp:</strong> ${t.class||"N/A"}</p><p><strong>Khoa:</strong> ${t.faculty||"N/A"}</p><p><strong>GPA t√≠ch l≈©y:</strong> <span class="font-bold text-emerald-400">${n.toFixed(2)}</span></p></div><div class="course-table-wrap mt-4">${renderCourseTable(t.courses,!0)}</div></div>`})}

        function appendMessage(text, type) {
            const chatbotMessages = document.getElementById('chatbot-messages');
            if(!chatbotMessages) return;
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', type + '-message');
            messageElement.textContent = text;
            chatbotMessages.appendChild(messageElement);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        async function handleChatbotResponse(message) {
            const lowerMessage = message.toLowerCase();
            let response = "";
            if (lowerMessage.includes("v·ªÅ b·∫°n chatbot") || lowerMessage.includes("chatbot") || lowerMessage.includes("b·∫°n l√† ai")) {
                response = "T√¥i l√† chatbot ƒë∆∞·ª£c FoxST t·∫°o ra ƒë·ªÉ gi·∫£i quy·∫øt th·∫Øc m·∫Øc c·ªßa b·∫°n v·ªÅ app, v√† c√≥ th·ªÉ tr·∫£ l·ªùi c√°c c√¢u h·ªèi n√¢ng cao ngo√†i l·ªÅ. Vui l√≤ng nh·∫≠p th·∫Øc m·∫Øc c·ªßa b·∫°n t√¥i s·∫Ω tr·∫£ l·ªùi.";
            } else if (lowerMessage.includes("v·ªÅ app") || lowerMessage.includes("app n√†y")) {
                response = "·ª®ng d·ª•ng n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ gi√∫p b·∫°n d·ªÖ d√†ng theo d√µi k·∫øt qu·∫£ h·ªçc t·∫≠p, t√≠nh to√°n ƒëi·ªÉm trung b√¨nh (GPA) v√† l∆∞u tr·ªØ th√¥ng tin c√° nh√¢n.";
            } else if (lowerMessage.includes("li√™n h·ªá") || lowerMessage.includes("li√™n l·∫°c") || lowerMessage.includes("facebook") || lowerMessage.includes("email")) {
                response = "B·∫°n c√≥ th·ªÉ li√™n h·ªá v·ªõi nh√† ph√°t tri·ªÉn qua:\n- Facebook: https://www.facebook.com/nguyen.hai.225063\n- Email: nguyenvanhai.10a3@gmail.com";
            } else if (lowerMessage.includes("th√™m sinh vi√™n") || lowerMessage.includes("th√™m sv")) {
                response = "ƒê·ªÉ th√™m sinh vi√™n m·ªõi, b·∫°n h√£y ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin v√†o bi·ªÉu m·∫´u 'Th√™m Sinh Vi√™n M·ªõi' ·ªü ƒë·∫ßu trang v√† nh·∫•n n√∫t 'Th√™m Sinh Vi√™n'.";
            } else if (lowerMessage.includes("th√™m m√¥n h·ªçc") || lowerMessage.includes("th√™m m√¥n")) {
                response = "ƒê·ªÉ th√™m m√¥n h·ªçc, b·∫°n ch·ªçn sinh vi√™n c·∫ßn th√™m m√¥n, ƒëi·ªÅn t√™n m√¥n h·ªçc, s·ªë t√≠n ch·ªâ v√† ƒëi·ªÉm. B·∫°n c√≥ th·ªÉ ch·ªçn 'T√≠nh ƒëi·ªÉm chi ti·∫øt' ƒë·ªÉ nh·∫≠p ƒëi·ªÉm th√†nh ph·∫ßn.";
            } else if (lowerMessage.includes("t√≠nh ƒëi·ªÉm") || lowerMessage.includes("gpa")) {
                response = "·ª®ng d·ª•ng s·∫Ω t·ª± ƒë·ªông t√≠nh ƒëi·ªÉm GPA sau khi b·∫°n th√™m m√¥n h·ªçc cho sinh vi√™n. ƒêi·ªÉm GPA s·∫Ω hi·ªÉn th·ªã ngay tr√™n th·∫ª th√¥ng tin c·ªßa sinh vi√™n ƒë√≥.";
            } else if (lowerMessage.includes("in danh s√°ch ") || lowerMessage.includes("xu·∫•t file")) {
                response = "B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng n√∫t m√°y in ·ªü g√≥c d∆∞·ªõi b√™n ph·∫£i ƒë·ªÉ in th√¥ng tin c·ªßa sinh vi√™n. Sau ƒë√≥, b·∫°n c√≥ th·ªÉ ch·ªçn in t·∫•t c·∫£ ho·∫∑c in m·ªôt sinh vi√™n c·ª• th·ªÉ.";
            } else if (lowerMessage.includes("x√≥a") || lowerMessage.includes("xo√°")) {
                response = "B·∫°n c√≥ th·ªÉ x√≥a sinh vi√™n ho·∫∑c m√¥n h·ªçc b·∫±ng c√°ch nh·∫•n v√†o bi·ªÉu t∆∞·ª£ng th√πng r√°c (x) t∆∞∆°ng ·ª©ng tr√™n th·∫ª th√¥ng tin c·ªßa h·ªç.";
            } else {
                appendMessage("ƒêang nh·∫≠p...", 'bot');
                try {
                    const geminiResponse = await getGeminiResponse(message);
                    document.getElementById('chatbot-messages').lastChild.textContent = geminiResponse;
                    return;
                } catch (error) {
                    document.getElementById('chatbot-messages').lastChild.textContent = "Xin l·ªói, t√¥i kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu c·ªßa b·∫°n l√∫c n√†y. Vui l√≤ng th·ª≠ l·∫°i sau.";
                    return;
                }
            }
            appendMessage(response, 'bot');
        }

        async function getGeminiResponse(query) {
    
    const API_ENDPOINT = '/api/chat'; 

    const currentYear = new Date().getFullYear();
    const contextualQuery = `NƒÉm hi·ªán t·∫°i l√† ${currentYear}. Vui l√≤ng tr·∫£ l·ªùi c√¢u h·ªèi sau: ${query}`;

    try {
        const response = await fetch(API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
          
            body: JSON.stringify({ query: contextualQuery }) 
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(`L·ªói t·ª´ server: ${errorData.error}`);
        }
        
        const data = await response.json();

     
        if (data.candidates && data.candidates[0]?.content?.parts[0]?.text) {
            return data.candidates[0].content.parts[0].text;
        } else {
            return "Xin l·ªói, t√¥i kh√¥ng th·ªÉ t·∫°o c√¢u tr·∫£ l·ªùi cho y√™u c·∫ßu n√†y.";
        }
    } catch (error) {
        console.error("L·ªói khi g·ªçi API qua serverless function:", error);
        return "ƒê√£ x·∫£y ra l·ªói k·∫øt n·ªëi ƒë·∫øn chatbot. Vui l√≤ng th·ª≠ l·∫°i sau.";
    }
}

         document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadAccentColor();
            loadFontColor();
            loadCardBgColor();
            loadBackground();

            auth.onAuthStateChanged(handleAuthStateChange);
            setupRealtimeListener();

            document.getElementById('login-btn').addEventListener('click', signInWithGoogle);
            document.getElementById('logout-btn').addEventListener('click', signOut);

            document.getElementById("openPrintModalBtn").addEventListener("click",()=>{
                if (!isLoggedIn) { alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng In."); return; }
                renderPrintOptions();
                document.getElementById("printModal").classList.add("show");
            });

            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    // Ch·ªâ x·ª≠ l√Ω cho c√°c link tab n·ªôi b·ªô
                    if (link.hasAttribute('data-tab')) {
                        e.preventDefault();
                        switchTab(link.dataset.tab);
                        if (window.innerWidth < 768) {
                            document.getElementById('sidebar').classList.add('-translate-x-full');
                            document.getElementById('sidebar-backdrop').classList.remove('active');
                        }
                    }
                   
                });
            });

            document.getElementById('editStudentForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const studentId = document.getElementById('editStudentId').value;
                updateStudentData(studentId, {
                    name: document.getElementById('editStudentName').value,
                    class: document.getElementById('editStudentClass').value,
                    faculty: document.getElementById('editStudentFaculty').value,
                });
                document.getElementById('editStudentModal').classList.remove('show');
            });
            
            const sidebar = document.getElementById("sidebar"), sidebarBackdrop = document.getElementById("sidebar-backdrop");
            document.getElementById("open-sidebar-btn").addEventListener("click",()=>{sidebar.classList.remove("-translate-x-full");sidebarBackdrop.classList.add("active")});
            document.getElementById("close-sidebar-btn").addEventListener("click",()=>{sidebar.classList.add("-translate-x-full");sidebarBackdrop.classList.remove("active")});
            sidebarBackdrop.addEventListener("click",()=>{sidebar.classList.add("-translate-x-full");sidebarBackdrop.classList.remove("active")});

            document.getElementById("closeEditStudentModalBtn").addEventListener("click",()=>document.getElementById("editStudentModal").classList.remove("show"));
            
            const printModal=document.getElementById("printModal");
            document.getElementById("closePrintModalBtn").addEventListener("click",()=>printModal.classList.remove("show"));
            document.getElementById("printAllBtn").addEventListener("click",()=>{createPrintContent(students);window.print();printModal.classList.remove("show")});
            document.getElementById("printSelectedBtn").addEventListener("click",()=>{const selectedIds=Array.from(document.querySelectorAll(".print-checkbox:checked")).map(cb=>cb.dataset.studentId);const selectedStudents=students.filter(s=>selectedIds.includes(s.id));createPrintContent(selectedStudents);window.print();printModal.classList.remove("show")});
            
            const themeModal=document.getElementById("themeModal");
            document.getElementById("openThemeModalBtn").addEventListener("click",()=>themeModal.classList.add("show"));
            document.getElementById("closeThemeModalBtn").addEventListener("click",()=>themeModal.classList.remove("show"));
            document.getElementById("lightModeBtn").addEventListener("click",()=>applyTheme("light"));
            document.getElementById("darkModeBtn").addEventListener("click",()=>applyTheme("dark"));
            document.getElementById("accentColorPicker").addEventListener("input",e=>applyAccentColor(e.target.value));
            document.getElementById("fontColorPicker").addEventListener("input",e=>applyFontColor(e.target.value));
            document.getElementById("cardBgColorPicker").addEventListener("input",e=>applyCardBgColor(e.target.value));
            document.getElementById("bgImageFile").addEventListener("change",e=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=e=>applyBackground(e.target.result);reader.readAsDataURL(file)}});
            document.getElementById("removeBgBtn").addEventListener("click",()=>applyBackground(null));
            
            const chatbotWindow=document.getElementById("chatbot-window"),sendBtn=document.getElementById("send-btn"),chatbotInputField=document.getElementById("chatbot-input-field");
            document.getElementById("chatbot-button").addEventListener("click",()=>chatbotWindow.classList.toggle("active"));
            document.getElementById("close-chatbot-btn").addEventListener("click",()=>chatbotWindow.classList.remove("active"));
            const sendMessage=()=>{const text=chatbotInputField.value.trim();if(text){appendMessage(text,"user");chatbotInputField.value="";handleChatbotResponse(text)}};
            sendBtn.addEventListener("click",sendMessage);
            chatbotInputField.addEventListener("keypress",e=>{"Enter"===e.key&&sendMessage()});

            switchTab('intro');
            attachEventListeners();
        });
    </script>
     <script src="/_vercel/insights/script.js"></script>
    <script src="/_vercel/speed-insights/script.js"></script>
</body>
</html>


